hub:
  config:
    Authenticator:
      admin_users:
        - admin
      allowed_users:
        - user1
        - ec2-user
        - ianleely
    # testing only - do not do this for production
    DummyAuthenticator:
      password: never-do-this
    JupyterHub:
      authenticator_class: dummy
      http_timeout: 1200  # 与 singleuser.startTimeout 一致
    KubeSpawner:
      k8s_api_request_timeout: 240
  extraConfig:
    jupyterhub_config.py: |-
      c.Spawner.start_timeout = 1200
      c.KubeSpawner.start_timeout = 1200
      c.Spawner.http_timeout = 1200  
      c.Spawner.args = ['--allow-root']
proxy:
  service:
    annotations:
      service.beta.kubernetes.io/aws-load-balancer-nlb-target-type: ip
      service.beta.kubernetes.io/aws-load-balancer-scheme: internal
      # service.beta.kubernetes.io/aws-load-balancer-scheme: internet-facing # Private Load Balancer can only be accessed within the VPC
      service.beta.kubernetes.io/aws-load-balancer-type: external
      service.beta.kubernetes.io/aws-load-balancer-cross-zone-load-balancing-enabled: 'true'
      service.beta.kubernetes.io/aws-load-balancer-ip-address-type: ipv4
singleuser:
  image:
    name: public.ecr.aws/h3o5n2r0/gpu-jupyter
    tag: v1.5_cuda-11.6_ubuntu-20.04_python-only
    pullPolicy: Always
  cmd: null
  startTimeout: 1200
  memory:
    guarantee: 8G
  extraResource:
    limits:
      nvidia.com/gpu: "1"
  storage:
    type: "static"
    static:
      pvcName: "efs-persist"
      subPath: "home/{username}"
    capacity: 25Gi
    extraVolumes:
      - name: shm-volume
        emptyDir:
          medium: Memory
      - name: notebook
        configMap:
          name: notebook
#      - name: efs-persist
#        persistentVolumeClaim:
#          claimName: efs-persist  # 挂载 efs-persist PVC
#      - name: efs-persist-shared
#        persistentVolumeClaim:
#          claimName: efs-persist-shared  # 挂载 efs-persist-shared PVC
    extraVolumeMounts:
      - name: shm-volume
        mountPath: /dev/shm
      - name: notebook
        mountPath: /home/jovyan/dogbooth
#      - name: efs-persist
#        mountPath: /home/jovyan/efs-persist  # 挂载到 /home/jovyan/efs-persist
#      - name: efs-persist-shared
#        mountPath: /home/jovyan/efs-persist-shared  # 挂载到 /home/jovyan/efs-persist-shared
  allowPrivilegeEscalation: true
  extraPodConfig: # This is needed for Jovyan user running in every single pod, access the Service Account
    securityContext:
      fsGroup: 100
  extraEnv: # Sudo needed to configure the proper permissions to start the notebook instance
    GRANT_SUDO: "yes"
    NOTEBOOK_ARGS: "--allow-root"
    CHOWN_HOME: "no"
    CHOWN_HOME_OPTS: "-R"
#    CHOWN_EXTRA: "/home/shared"
  uid: 0
  fsGid: 0

  extraTolerations:
    - key: nvidia.com/gpu
      operator: Exists
      effect: NoSchedule
scheduling:
  userScheduler:
    enabled: false
